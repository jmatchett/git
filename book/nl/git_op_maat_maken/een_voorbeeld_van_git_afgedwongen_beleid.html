<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Een voorbeeld van Git-afgedwongen beleid | Learn Git</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="jmatchett">
        <meta name="description" content="This is a GitBook version of the Scott Chacon&#39;s book: [Pro Git](https://github.com/progit/progit).">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../git_op_maat_maken/samenvatting.html" />
        
        
        <link rel="prev" href="../git_op_maat_maken/git_haken_hooks.html" />
        

        <meta property="og:title" content="Een voorbeeld van Git-afgedwongen beleid | Learn Git">
        <meta property="og:site_name" content="Learn Git">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/jmatchett">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="../gitbook/style.css">
        


        
    <div class="book" data-github="jmatchett/git" data-level="7.4" data-basepath=".." data-revision="1398354147095">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/jmatchett/git" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    
    <a href="https://github.com/jmatchett/git/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/jmatchett/git/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1><a href="../" >Learn Git</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/jmatchett" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/jmatchett/git/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/jmatchett/git/edit/master/git_op_maat_maken/een_voorbeeld_van_git_afgedwongen_beleid.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        
        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="aan_de_slag/README.html">
                
                <a href="../aan_de_slag/README.html">
                    <i class="fa fa-check"></i> <b>1.</b> Aan de slag
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="aan_de_slag/het_wat_en_waarom_van_versiebeheer.html">
                            
                            <a href="../aan_de_slag/het_wat_en_waarom_van_versiebeheer.html">
                                <i class="fa fa-check"></i> <b>1.1.</b> Het wat en waarom van versiebeheer
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" data-path="aan_de_slag/een_kort_historisch_overzicht_van_git.html">
                            
                            <a href="../aan_de_slag/een_kort_historisch_overzicht_van_git.html">
                                <i class="fa fa-check"></i> <b>1.2.</b> Een kort historisch overzicht van Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3" data-path="aan_de_slag/de_basis_van_git.html">
                            
                            <a href="../aan_de_slag/de_basis_van_git.html">
                                <i class="fa fa-check"></i> <b>1.3.</b> De basis van Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.4" data-path="aan_de_slag/git_installeren.html">
                            
                            <a href="../aan_de_slag/git_installeren.html">
                                <i class="fa fa-check"></i> <b>1.4.</b> Git installeren
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.5" data-path="aan_de_slag/git_klaarmaken_voor_eerste_gebruik.html">
                            
                            <a href="../aan_de_slag/git_klaarmaken_voor_eerste_gebruik.html">
                                <i class="fa fa-check"></i> <b>1.5.</b> Git klaarmaken voor eerste gebruik
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.6" data-path="aan_de_slag/hulp_krijgen.html">
                            
                            <a href="../aan_de_slag/hulp_krijgen.html">
                                <i class="fa fa-check"></i> <b>1.6.</b> Hulp krijgen
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.7" data-path="aan_de_slag/samenvatting.html">
                            
                            <a href="../aan_de_slag/samenvatting.html">
                                <i class="fa fa-check"></i> <b>1.7.</b> Samenvatting
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2" data-path="de_basis_van_git/README.html">
                
                <a href="../de_basis_van_git/README.html">
                    <i class="fa fa-check"></i> <b>2.</b> De basis van Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="de_basis_van_git/een_git_repository_verkrijgen.html">
                            
                            <a href="../de_basis_van_git/een_git_repository_verkrijgen.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> Een Git repository verkrijgen
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="de_basis_van_git/wijzigingen_aan_het_repository_vastleggen.html">
                            
                            <a href="../de_basis_van_git/wijzigingen_aan_het_repository_vastleggen.html">
                                <i class="fa fa-check"></i> <b>2.2.</b> Wijzigingen aan het repository vastleggen
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="de_basis_van_git/de_commit_geschiedenis_bekijken.html">
                            
                            <a href="../de_basis_van_git/de_commit_geschiedenis_bekijken.html">
                                <i class="fa fa-check"></i> <b>2.3.</b> De commit geschiedenis bekijken
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" data-path="de_basis_van_git/dingen_ongedaan_maken.html">
                            
                            <a href="../de_basis_van_git/dingen_ongedaan_maken.html">
                                <i class="fa fa-check"></i> <b>2.4.</b> Dingen ongedaan maken
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5" data-path="de_basis_van_git/werken_met_remotes.html">
                            
                            <a href="../de_basis_van_git/werken_met_remotes.html">
                                <i class="fa fa-check"></i> <b>2.5.</b> Werken met remotes
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.6" data-path="de_basis_van_git/taggen_labelen.html">
                            
                            <a href="../de_basis_van_git/taggen_labelen.html">
                                <i class="fa fa-check"></i> <b>2.6.</b> Taggen (Labelen)
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.7" data-path="de_basis_van_git/tips_en_trucs.html">
                            
                            <a href="../de_basis_van_git/tips_en_trucs.html">
                                <i class="fa fa-check"></i> <b>2.7.</b> Tips en trucs
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.8" data-path="de_basis_van_git/samenvatting.html">
                            
                            <a href="../de_basis_van_git/samenvatting.html">
                                <i class="fa fa-check"></i> <b>2.8.</b> Samenvatting
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3" data-path="branchen_in_git/README.html">
                
                <a href="../branchen_in_git/README.html">
                    <i class="fa fa-check"></i> <b>3.</b> Branchen in Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" data-path="branchen_in_git/wat_is_een_branch.html">
                            
                            <a href="../branchen_in_git/wat_is_een_branch.html">
                                <i class="fa fa-check"></i> <b>3.1.</b> Wat is een branch
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.2" data-path="branchen_in_git/eenvoudig_branchen_en_mergen.html">
                            
                            <a href="../branchen_in_git/eenvoudig_branchen_en_mergen.html">
                                <i class="fa fa-check"></i> <b>3.2.</b> Eenvoudig branchen en mergen
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.3" data-path="branchen_in_git/branch_beheer.html">
                            
                            <a href="../branchen_in_git/branch_beheer.html">
                                <i class="fa fa-check"></i> <b>3.3.</b> Branch beheer
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.4" data-path="branchen_in_git/branch_workflows.html">
                            
                            <a href="../branchen_in_git/branch_workflows.html">
                                <i class="fa fa-check"></i> <b>3.4.</b> Branch workflows
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.5" data-path="branchen_in_git/remote_branches.html">
                            
                            <a href="../branchen_in_git/remote_branches.html">
                                <i class="fa fa-check"></i> <b>3.5.</b> Remote branches
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.6" data-path="branchen_in_git/rebasen.html">
                            
                            <a href="../branchen_in_git/rebasen.html">
                                <i class="fa fa-check"></i> <b>3.6.</b> Rebasen
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.7" data-path="branchen_in_git/samenvatting.html">
                            
                            <a href="../branchen_in_git/samenvatting.html">
                                <i class="fa fa-check"></i> <b>3.7.</b> Samenvatting
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="4" data-path="git_op_de_server/README.html">
                
                <a href="../git_op_de_server/README.html">
                    <i class="fa fa-check"></i> <b>4.</b> Git op de server
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1" data-path="git_op_de_server/de_protocollen.html">
                            
                            <a href="../git_op_de_server/de_protocollen.html">
                                <i class="fa fa-check"></i> <b>4.1.</b> De protocollen
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.2" data-path="git_op_de_server/git_op_een_server_krijgen.html">
                            
                            <a href="../git_op_de_server/git_op_een_server_krijgen.html">
                                <i class="fa fa-check"></i> <b>4.2.</b> Git op een server krijgen
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.3" data-path="git_op_de_server/je_publieke_ssh_sleutel_genereren.html">
                            
                            <a href="../git_op_de_server/je_publieke_ssh_sleutel_genereren.html">
                                <i class="fa fa-check"></i> <b>4.3.</b> Je publieke SSH sleutel genereren
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.4" data-path="git_op_de_server/de_server_opzetten.html">
                            
                            <a href="../git_op_de_server/de_server_opzetten.html">
                                <i class="fa fa-check"></i> <b>4.4.</b> De Server Opzetten
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.5" data-path="git_op_de_server/publieke_toegang.html">
                            
                            <a href="../git_op_de_server/publieke_toegang.html">
                                <i class="fa fa-check"></i> <b>4.5.</b> Publieke toegang
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.6" data-path="git_op_de_server/gitweb.html">
                            
                            <a href="../git_op_de_server/gitweb.html">
                                <i class="fa fa-check"></i> <b>4.6.</b> GitWeb
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.7" data-path="git_op_de_server/gitosis.html">
                            
                            <a href="../git_op_de_server/gitosis.html">
                                <i class="fa fa-check"></i> <b>4.7.</b> Gitosis
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.8" data-path="git_op_de_server/gitolite.html">
                            
                            <a href="../git_op_de_server/gitolite.html">
                                <i class="fa fa-check"></i> <b>4.8.</b> Gitolite
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.9" data-path="git_op_de_server/git_daemon.html">
                            
                            <a href="../git_op_de_server/git_daemon.html">
                                <i class="fa fa-check"></i> <b>4.9.</b> Git daemon
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.10" data-path="git_op_de_server/gehoste_git.html">
                            
                            <a href="../git_op_de_server/gehoste_git.html">
                                <i class="fa fa-check"></i> <b>4.10.</b> Gehoste Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.11" data-path="git_op_de_server/samenvatting.html">
                            
                            <a href="../git_op_de_server/samenvatting.html">
                                <i class="fa fa-check"></i> <b>4.11.</b> Samenvatting
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="5" data-path="gedistribueerd_git/README.html">
                
                <a href="../gedistribueerd_git/README.html">
                    <i class="fa fa-check"></i> <b>5.</b> Gedistribueerd Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="5.1" data-path="gedistribueerd_git/gedistribueerde_workflows.html">
                            
                            <a href="../gedistribueerd_git/gedistribueerde_workflows.html">
                                <i class="fa fa-check"></i> <b>5.1.</b> Gedistribueerde workflows
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.2" data-path="gedistribueerd_git/bijdragen_aan_een_project.html">
                            
                            <a href="../gedistribueerd_git/bijdragen_aan_een_project.html">
                                <i class="fa fa-check"></i> <b>5.2.</b> Bijdragen aan een project
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.3" data-path="gedistribueerd_git/het_beheren_van_een_project.html">
                            
                            <a href="../gedistribueerd_git/het_beheren_van_een_project.html">
                                <i class="fa fa-check"></i> <b>5.3.</b> Het beheren van een project
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.4" data-path="gedistribueerd_git/samenvatting.html">
                            
                            <a href="../gedistribueerd_git/samenvatting.html">
                                <i class="fa fa-check"></i> <b>5.4.</b> Samenvatting
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="6" data-path="git_tools/README.html">
                
                <a href="../git_tools/README.html">
                    <i class="fa fa-check"></i> <b>6.</b> Git tools
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="6.1" data-path="git_tools/revisie_selectie.html">
                            
                            <a href="../git_tools/revisie_selectie.html">
                                <i class="fa fa-check"></i> <b>6.1.</b> Revisie selectie
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.2" data-path="git_tools/interactief_stagen.html">
                            
                            <a href="../git_tools/interactief_stagen.html">
                                <i class="fa fa-check"></i> <b>6.2.</b> Interactief stagen
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.3" data-path="git_tools/stashen.html">
                            
                            <a href="../git_tools/stashen.html">
                                <i class="fa fa-check"></i> <b>6.3.</b> Stashen
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.4" data-path="git_tools/geschiedenis_herschrijven.html">
                            
                            <a href="../git_tools/geschiedenis_herschrijven.html">
                                <i class="fa fa-check"></i> <b>6.4.</b> Geschiedenis herschrijven
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.5" data-path="git_tools/debuggen_met_git.html">
                            
                            <a href="../git_tools/debuggen_met_git.html">
                                <i class="fa fa-check"></i> <b>6.5.</b> Debuggen met Git
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.6" data-path="git_tools/submodules.html">
                            
                            <a href="../git_tools/submodules.html">
                                <i class="fa fa-check"></i> <b>6.6.</b> Submodules
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.7" data-path="git_tools/subboom_mergen.html">
                            
                            <a href="../git_tools/subboom_mergen.html">
                                <i class="fa fa-check"></i> <b>6.7.</b> Subboom mergen
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.8" data-path="git_tools/samenvatting.html">
                            
                            <a href="../git_tools/samenvatting.html">
                                <i class="fa fa-check"></i> <b>6.8.</b> Samenvatting
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="7" data-path="git_op_maat_maken/README.html">
                
                <a href="../git_op_maat_maken/README.html">
                    <i class="fa fa-check"></i> <b>7.</b> Git op maat maken
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="7.1" data-path="git_op_maat_maken/git_configuratie.html">
                            
                            <a href="../git_op_maat_maken/git_configuratie.html">
                                <i class="fa fa-check"></i> <b>7.1.</b> Git configuratie
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.2" data-path="git_op_maat_maken/git_attributen.html">
                            
                            <a href="../git_op_maat_maken/git_attributen.html">
                                <i class="fa fa-check"></i> <b>7.2.</b> Git attributen
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.3" data-path="git_op_maat_maken/git_haken_hooks.html">
                            
                            <a href="../git_op_maat_maken/git_haken_hooks.html">
                                <i class="fa fa-check"></i> <b>7.3.</b> Git haken (hooks)
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.4" data-path="git_op_maat_maken/een_voorbeeld_van_git_afgedwongen_beleid.html">
                            
                            <a href="../git_op_maat_maken/een_voorbeeld_van_git_afgedwongen_beleid.html">
                                <i class="fa fa-check"></i> <b>7.4.</b> Een voorbeeld van Git-afgedwongen beleid
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.5" data-path="git_op_maat_maken/samenvatting.html">
                            
                            <a href="../git_op_maat_maken/samenvatting.html">
                                <i class="fa fa-check"></i> <b>7.5.</b> Samenvatting
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="8" data-path="git_en_andere_systemen/README.html">
                
                <a href="../git_en_andere_systemen/README.html">
                    <i class="fa fa-check"></i> <b>8.</b> Git en andere systemen
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="8.1" data-path="git_en_andere_systemen/git_en_subversion.html">
                            
                            <a href="../git_en_andere_systemen/git_en_subversion.html">
                                <i class="fa fa-check"></i> <b>8.1.</b> Git en Subversion
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.2" data-path="git_en_andere_systemen/naar_git_migreren.html">
                            
                            <a href="../git_en_andere_systemen/naar_git_migreren.html">
                                <i class="fa fa-check"></i> <b>8.2.</b> Naar Git migreren
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.3" data-path="git_en_andere_systemen/samenvatting.html">
                            
                            <a href="../git_en_andere_systemen/samenvatting.html">
                                <i class="fa fa-check"></i> <b>8.3.</b> Samenvatting
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="9" data-path="het_binnenwerk_van_git/README.html">
                
                <a href="../het_binnenwerk_van_git/README.html">
                    <i class="fa fa-check"></i> <b>9.</b> Het binnenwerk van Git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="9.1" data-path="het_binnenwerk_van_git/sanitaire_voorzieningen_en_porselein.html">
                            
                            <a href="../het_binnenwerk_van_git/sanitaire_voorzieningen_en_porselein.html">
                                <i class="fa fa-check"></i> <b>9.1.</b> Sanitaire voorzieningen en porselein
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.2" data-path="het_binnenwerk_van_git/git_objecten.html">
                            
                            <a href="../het_binnenwerk_van_git/git_objecten.html">
                                <i class="fa fa-check"></i> <b>9.2.</b> Git objecten
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.3" data-path="het_binnenwerk_van_git/git_referenties.html">
                            
                            <a href="../het_binnenwerk_van_git/git_referenties.html">
                                <i class="fa fa-check"></i> <b>9.3.</b> Git referenties
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.4" data-path="het_binnenwerk_van_git/packfiles.html">
                            
                            <a href="../het_binnenwerk_van_git/packfiles.html">
                                <i class="fa fa-check"></i> <b>9.4.</b> Packfiles
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.5" data-path="het_binnenwerk_van_git/de_refspec.html">
                            
                            <a href="../het_binnenwerk_van_git/de_refspec.html">
                                <i class="fa fa-check"></i> <b>9.5.</b> De refspec
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.6" data-path="het_binnenwerk_van_git/overdracht_protocollen.html">
                            
                            <a href="../het_binnenwerk_van_git/overdracht_protocollen.html">
                                <i class="fa fa-check"></i> <b>9.6.</b> Overdracht protocollen
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.7" data-path="het_binnenwerk_van_git/onderhoud_en_het_herstellen_van_gegevens.html">
                            
                            <a href="../het_binnenwerk_van_git/onderhoud_en_het_herstellen_van_gegevens.html">
                                <i class="fa fa-check"></i> <b>9.7.</b> Onderhoud en het herstellen van gegevens
                            </a>
                            
                        </li>
                    
                        <li  data-level="9.8" data-path="het_binnenwerk_van_git/samenvatting.html">
                            
                            <a href="../het_binnenwerk_van_git/samenvatting.html">
                                <i class="fa fa-check"></i> <b>9.8.</b> Samenvatting
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 80%;min-width: 78.57142857142857%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../aan_de_slag/README.html" title="Aan de slag" class="chapter done new-chapter" data-progress="1" style="left: 1.4285714285714286%;"></a>
    
        <a href="../aan_de_slag/het_wat_en_waarom_van_versiebeheer.html" title="Het wat en waarom van versiebeheer" class="chapter done " data-progress="1.1" style="left: 2.857142857142857%;"></a>
    
        <a href="../aan_de_slag/een_kort_historisch_overzicht_van_git.html" title="Een kort historisch overzicht van Git" class="chapter done " data-progress="1.2" style="left: 4.285714285714286%;"></a>
    
        <a href="../aan_de_slag/de_basis_van_git.html" title="De basis van Git" class="chapter done " data-progress="1.3" style="left: 5.714285714285714%;"></a>
    
        <a href="../aan_de_slag/git_installeren.html" title="Git installeren" class="chapter done " data-progress="1.4" style="left: 7.142857142857143%;"></a>
    
        <a href="../aan_de_slag/git_klaarmaken_voor_eerste_gebruik.html" title="Git klaarmaken voor eerste gebruik" class="chapter done " data-progress="1.5" style="left: 8.571428571428571%;"></a>
    
        <a href="../aan_de_slag/hulp_krijgen.html" title="Hulp krijgen" class="chapter done " data-progress="1.6" style="left: 10%;"></a>
    
        <a href="../aan_de_slag/samenvatting.html" title="Samenvatting" class="chapter done " data-progress="1.7" style="left: 11.428571428571429%;"></a>
    
        <a href="../de_basis_van_git/README.html" title="De basis van Git" class="chapter done new-chapter" data-progress="2" style="left: 12.857142857142858%;"></a>
    
        <a href="../de_basis_van_git/een_git_repository_verkrijgen.html" title="Een Git repository verkrijgen" class="chapter done " data-progress="2.1" style="left: 14.285714285714286%;"></a>
    
        <a href="../de_basis_van_git/wijzigingen_aan_het_repository_vastleggen.html" title="Wijzigingen aan het repository vastleggen" class="chapter done " data-progress="2.2" style="left: 15.714285714285714%;"></a>
    
        <a href="../de_basis_van_git/de_commit_geschiedenis_bekijken.html" title="De commit geschiedenis bekijken" class="chapter done " data-progress="2.3" style="left: 17.142857142857142%;"></a>
    
        <a href="../de_basis_van_git/dingen_ongedaan_maken.html" title="Dingen ongedaan maken" class="chapter done " data-progress="2.4" style="left: 18.571428571428573%;"></a>
    
        <a href="../de_basis_van_git/werken_met_remotes.html" title="Werken met remotes" class="chapter done " data-progress="2.5" style="left: 20%;"></a>
    
        <a href="../de_basis_van_git/taggen_labelen.html" title="Taggen (Labelen)" class="chapter done " data-progress="2.6" style="left: 21.428571428571427%;"></a>
    
        <a href="../de_basis_van_git/tips_en_trucs.html" title="Tips en trucs" class="chapter done " data-progress="2.7" style="left: 22.857142857142858%;"></a>
    
        <a href="../de_basis_van_git/samenvatting.html" title="Samenvatting" class="chapter done " data-progress="2.8" style="left: 24.285714285714285%;"></a>
    
        <a href="../branchen_in_git/README.html" title="Branchen in Git" class="chapter done new-chapter" data-progress="3" style="left: 25.714285714285715%;"></a>
    
        <a href="../branchen_in_git/wat_is_een_branch.html" title="Wat is een branch" class="chapter done " data-progress="3.1" style="left: 27.142857142857142%;"></a>
    
        <a href="../branchen_in_git/eenvoudig_branchen_en_mergen.html" title="Eenvoudig branchen en mergen" class="chapter done " data-progress="3.2" style="left: 28.571428571428573%;"></a>
    
        <a href="../branchen_in_git/branch_beheer.html" title="Branch beheer" class="chapter done " data-progress="3.3" style="left: 30%;"></a>
    
        <a href="../branchen_in_git/branch_workflows.html" title="Branch workflows" class="chapter done " data-progress="3.4" style="left: 31.428571428571427%;"></a>
    
        <a href="../branchen_in_git/remote_branches.html" title="Remote branches" class="chapter done " data-progress="3.5" style="left: 32.857142857142854%;"></a>
    
        <a href="../branchen_in_git/rebasen.html" title="Rebasen" class="chapter done " data-progress="3.6" style="left: 34.285714285714285%;"></a>
    
        <a href="../branchen_in_git/samenvatting.html" title="Samenvatting" class="chapter done " data-progress="3.7" style="left: 35.714285714285715%;"></a>
    
        <a href="../git_op_de_server/README.html" title="Git op de server" class="chapter done new-chapter" data-progress="4" style="left: 37.142857142857146%;"></a>
    
        <a href="../git_op_de_server/de_protocollen.html" title="De protocollen" class="chapter done " data-progress="4.1" style="left: 38.57142857142857%;"></a>
    
        <a href="../git_op_de_server/gehoste_git.html" title="Gehoste Git" class="chapter done " data-progress="4.10" style="left: 40%;"></a>
    
        <a href="../git_op_de_server/samenvatting.html" title="Samenvatting" class="chapter done " data-progress="4.11" style="left: 41.42857142857143%;"></a>
    
        <a href="../git_op_de_server/git_op_een_server_krijgen.html" title="Git op een server krijgen" class="chapter done " data-progress="4.2" style="left: 42.857142857142854%;"></a>
    
        <a href="../git_op_de_server/je_publieke_ssh_sleutel_genereren.html" title="Je publieke SSH sleutel genereren" class="chapter done " data-progress="4.3" style="left: 44.285714285714285%;"></a>
    
        <a href="../git_op_de_server/de_server_opzetten.html" title="De Server Opzetten" class="chapter done " data-progress="4.4" style="left: 45.714285714285715%;"></a>
    
        <a href="../git_op_de_server/publieke_toegang.html" title="Publieke toegang" class="chapter done " data-progress="4.5" style="left: 47.142857142857146%;"></a>
    
        <a href="../git_op_de_server/gitweb.html" title="GitWeb" class="chapter done " data-progress="4.6" style="left: 48.57142857142857%;"></a>
    
        <a href="../git_op_de_server/gitosis.html" title="Gitosis" class="chapter done " data-progress="4.7" style="left: 50%;"></a>
    
        <a href="../git_op_de_server/gitolite.html" title="Gitolite" class="chapter done " data-progress="4.8" style="left: 51.42857142857143%;"></a>
    
        <a href="../git_op_de_server/git_daemon.html" title="Git daemon" class="chapter done " data-progress="4.9" style="left: 52.857142857142854%;"></a>
    
        <a href="../gedistribueerd_git/README.html" title="Gedistribueerd Git" class="chapter done new-chapter" data-progress="5" style="left: 54.285714285714285%;"></a>
    
        <a href="../gedistribueerd_git/gedistribueerde_workflows.html" title="Gedistribueerde workflows" class="chapter done " data-progress="5.1" style="left: 55.714285714285715%;"></a>
    
        <a href="../gedistribueerd_git/bijdragen_aan_een_project.html" title="Bijdragen aan een project" class="chapter done " data-progress="5.2" style="left: 57.142857142857146%;"></a>
    
        <a href="../gedistribueerd_git/het_beheren_van_een_project.html" title="Het beheren van een project" class="chapter done " data-progress="5.3" style="left: 58.57142857142857%;"></a>
    
        <a href="../gedistribueerd_git/samenvatting.html" title="Samenvatting" class="chapter done " data-progress="5.4" style="left: 60%;"></a>
    
        <a href="../git_tools/README.html" title="Git tools" class="chapter done new-chapter" data-progress="6" style="left: 61.42857142857143%;"></a>
    
        <a href="../git_tools/revisie_selectie.html" title="Revisie selectie" class="chapter done " data-progress="6.1" style="left: 62.857142857142854%;"></a>
    
        <a href="../git_tools/interactief_stagen.html" title="Interactief stagen" class="chapter done " data-progress="6.2" style="left: 64.28571428571429%;"></a>
    
        <a href="../git_tools/stashen.html" title="Stashen" class="chapter done " data-progress="6.3" style="left: 65.71428571428571%;"></a>
    
        <a href="../git_tools/geschiedenis_herschrijven.html" title="Geschiedenis herschrijven" class="chapter done " data-progress="6.4" style="left: 67.14285714285714%;"></a>
    
        <a href="../git_tools/debuggen_met_git.html" title="Debuggen met Git" class="chapter done " data-progress="6.5" style="left: 68.57142857142857%;"></a>
    
        <a href="../git_tools/submodules.html" title="Submodules" class="chapter done " data-progress="6.6" style="left: 70%;"></a>
    
        <a href="../git_tools/subboom_mergen.html" title="Subboom mergen" class="chapter done " data-progress="6.7" style="left: 71.42857142857143%;"></a>
    
        <a href="../git_tools/samenvatting.html" title="Samenvatting" class="chapter done " data-progress="6.8" style="left: 72.85714285714286%;"></a>
    
        <a href="../git_op_maat_maken/README.html" title="Git op maat maken" class="chapter done new-chapter" data-progress="7" style="left: 74.28571428571429%;"></a>
    
        <a href="../git_op_maat_maken/git_configuratie.html" title="Git configuratie" class="chapter done " data-progress="7.1" style="left: 75.71428571428571%;"></a>
    
        <a href="../git_op_maat_maken/git_attributen.html" title="Git attributen" class="chapter done " data-progress="7.2" style="left: 77.14285714285714%;"></a>
    
        <a href="../git_op_maat_maken/git_haken_hooks.html" title="Git haken (hooks)" class="chapter done " data-progress="7.3" style="left: 78.57142857142857%;"></a>
    
        <a href="../git_op_maat_maken/een_voorbeeld_van_git_afgedwongen_beleid.html" title="Een voorbeeld van Git-afgedwongen beleid" class="chapter done " data-progress="7.4" style="left: 80%;"></a>
    
        <a href="../git_op_maat_maken/samenvatting.html" title="Samenvatting" class="chapter  " data-progress="7.5" style="left: 81.42857142857143%;"></a>
    
        <a href="../git_en_andere_systemen/README.html" title="Git en andere systemen" class="chapter  new-chapter" data-progress="8" style="left: 82.85714285714286%;"></a>
    
        <a href="../git_en_andere_systemen/git_en_subversion.html" title="Git en Subversion" class="chapter  " data-progress="8.1" style="left: 84.28571428571429%;"></a>
    
        <a href="../git_en_andere_systemen/naar_git_migreren.html" title="Naar Git migreren" class="chapter  " data-progress="8.2" style="left: 85.71428571428571%;"></a>
    
        <a href="../git_en_andere_systemen/samenvatting.html" title="Samenvatting" class="chapter  " data-progress="8.3" style="left: 87.14285714285714%;"></a>
    
        <a href="../het_binnenwerk_van_git/README.html" title="Het binnenwerk van Git" class="chapter  new-chapter" data-progress="9" style="left: 88.57142857142857%;"></a>
    
        <a href="../het_binnenwerk_van_git/sanitaire_voorzieningen_en_porselein.html" title="Sanitaire voorzieningen en porselein" class="chapter  " data-progress="9.1" style="left: 90%;"></a>
    
        <a href="../het_binnenwerk_van_git/git_objecten.html" title="Git objecten" class="chapter  " data-progress="9.2" style="left: 91.42857142857143%;"></a>
    
        <a href="../het_binnenwerk_van_git/git_referenties.html" title="Git referenties" class="chapter  " data-progress="9.3" style="left: 92.85714285714286%;"></a>
    
        <a href="../het_binnenwerk_van_git/packfiles.html" title="Packfiles" class="chapter  " data-progress="9.4" style="left: 94.28571428571429%;"></a>
    
        <a href="../het_binnenwerk_van_git/de_refspec.html" title="De refspec" class="chapter  " data-progress="9.5" style="left: 95.71428571428571%;"></a>
    
        <a href="../het_binnenwerk_van_git/overdracht_protocollen.html" title="Overdracht protocollen" class="chapter  " data-progress="9.6" style="left: 97.14285714285714%;"></a>
    
        <a href="../het_binnenwerk_van_git/onderhoud_en_het_herstellen_van_gegevens.html" title="Onderhoud en het herstellen van gegevens" class="chapter  " data-progress="9.7" style="left: 98.57142857142857%;"></a>
    
        <a href="../het_binnenwerk_van_git/samenvatting.html" title="Samenvatting" class="chapter  " data-progress="9.8" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_835">
                    
                        <h1 id="een-voorbeeld-van-git-afgedwongen-beleid">Een voorbeeld van Git-afgedwongen beleid</h1>
<p>In deze paragraaf ga je gebruiken wat je geleerd hebt om een Git workflow te maken, die controleert op een aangepast commit boodschap formaat, afdwingt om alleen fast-forward pushes te accepteren en alleen bepaalde gebruikers toestaat om bepaalde subdirectories te wijzigen in een project. Je zult client scripts maken die de ontwikkelaar helpen te ontdekken of hun push geweigerd zal worden en server scripts die het beleid afdwingen.</p>
<p>Ik heb Ruby gebruikt om ze te schrijven, zowel omdat het mijn voorkeur script taal is, als omdat ik vind dat het de meest pseudo code uitziende taal is van de scripttalen; dus je zou in staat moeten zijn om de code redelijk te kunnen volgen zelfs als je geen Ruby gebruikt. Maar elke taal zou prima werken. Alle voorbeeld hook scripts die met Git meegeleverd worden zijn Perl of Bash scripts, dus je kunt ook genoeg voorbeelden van hooks in die talen vinden door naar die bestanden te kijken.</p>
<h2 id="server-kant-hook">Server-kant hook</h2>
<p>Al het werk aan de server kant zal in het update bestand in je hooks directory gaan zitten. Het update bestand zal eens per gepushte branch uitgevoerd worden en accepteert de referentie waarnaar gepusht wordt, de oude revisie waar die branch was en de nieuwe gepushte revisie. Je hebt ook toegang tot de gebruiker die de push doet als de push via SSH gedaan wordt. Als je iedereen hebt toegestaan om connectie te maken als één gebruiker (zoals &quot;git&quot;) via publieke sleutel authenticatie, dan moet je wellicht die gebruiker een shell wrapper geven die bepaalt welke gebruiker er connectie maakt op basis van de publieke sleutel, en dan een omgevingsvariabele instellen waarin die gebruiker wordt gespecificeerd. Ik ga er vanuit dat de gebruiker in de <code>$USER</code> omgevingsvariabele staat, dus begint je update script met het verzamelen van alle gegevens die het nodig heeft:</p>
<pre><code>#!/usr/bin/env ruby

$refname = ARGV[0]
$oldrev  = ARGV[1]
$newrev  = ARGV[2]
$user    = ENV[&#39;USER&#39;]

puts &quot;Enforcing Policies... \n(#{$refname}) (#{$oldrev[0,6]}) (#{$newrev[0,6]})&quot;
</code></pre><p>Ja, ik gebruik globale variabelen. Schiet me niet af – het is makkelijker om het op deze manier te laten zien.</p>
<h3 id="een-specifiek-commit-bericht-formaat-afdwingen">Een specifiek commit-bericht formaat afdwingen</h3>
<p>Je eerste uitdaging is afdwingen dat elke commit bericht moet voldoen aan een specifiek formaat. Laten we zeggen dat ieder bericht een stuk tekst moet bevatten dat eruit ziet als &quot;ref: 1234&quot;, omdat je wilt dat iedere commit gekoppeld is aan een werkonderdeel in je ticket systeem. Je moet dus kijken naar iedere commit die gepusht wordt, zien of die tekst in de commit boodschap zit en als de tekst in één van de commits ontbreekt, met niet nul eindigen zodat de push geweigerd wordt.</p>
<p>Je kunt de lijst met alle SHA-1 waarden van alle commits die gepusht worden verkrijgen door de <code>$newrev</code> en <code>$oldrev</code> waarden te pakken en ze aan een Git plumbing commando genaamd <code>git rev-list</code> te geven. Dit is min of meer het <code>git log</code> commando, maar standaard voert het alleen de SHA-1 waarden uit en geen andere informatie. Dus, om een lijst te krijgen van alle commit SHA&#39;s die worden geïntroduceerd tussen één commit SHA en een andere, kun je zoiets als dit uitvoeren:</p>
<pre><code>$ git rev-list 538c33..d14fc7
d14fc7c847ab946ec39590d87783c69b031bdfb7
9f585da4401b0a3999e84113824d15245c13f0be
234071a1be950e2a8d078e6141f5cd20c1e61ad3
dfa04c9ef3d5197182f13fb5b9b1fb7717d2222a
17716ec0f1ff5c77eff40b7fe912f9f6cfd0e475
</code></pre><p>Je kunt die uitvoer pakken, door elk van die commit SHA&#39;s heen lopen, de boodschap daarvan pakken en die boodschap testen tegen een reguliere expressie die op een bepaald patroon zoekt.</p>
<p>Je moet uit zien te vinden hoe je de commit boodschap kunt krijgen van alle te testen commits. Om de echte commit gegevens te krijgen, kun je een andere plumbing commando genaamd <code>git cat-file</code> gebruiken. Ik zal al plumbing commando&#39;s in detail behandelen in Hoofdstuk 9, maar voor nu is dit wat het commando je geeft:</p>
<pre><code>$ git cat-file commit ca82a6
tree cfda3bf379e4f8dba8717dee55aab78aef7f4daf
parent 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
author Scott Chacon &lt;schacon@gmail.com&gt; 1205815931 -0700
committer Scott Chacon &lt;schacon@gmail.com&gt; 1240030591 -0700

changed the version number
</code></pre><p>Een simpele manier om de commit boodschap uit een commit waarvan je de SHA-1 waarde hebt te krijgen, is naar de eerste lege regel gaan en alles wat daarna komt pakken. Je kunt dat doen met het <code>sed</code> commando op Unix systemen:</p>
<pre><code>$ git cat-file commit ca82a6 | sed &#39;1,/^$/d&#39;
changed the version number
</code></pre><p>Je kunt die toverspreuk gebruiken om de commit boodschap te pakken van iedere commit die geprobeerd wordt te pushen en eindigen als je ziet dat er iets is wat niet past. Om het script te eindigen en de push te weigeren, eindig je met niet nul. De hele methode ziet er zo uit:</p>
<pre><code>$regex = /\[ref: (\d+)\]/

# eigen commit bericht formaat afgedwongen
def check_message_format
  missed_revs = `git rev-list #{$oldrev}..#{$newrev}`.split(&quot;\n&quot;)
  missed_revs.each do |rev|
    message = `git cat-file commit #{rev} | sed &#39;1,/^$/d&#39;`
    if !$regex.match(message)
      puts &quot;[POLICY] Your message is not formatted correctly&quot;
      exit 1
    end
  end
end
check_message_format
</code></pre><p>Door dat in je <code>update</code> script te stoppen, zullen updates geweigerd worden die commits bevatten met berichten die niet aan jouw beleid voldoen.</p>
<h3 id="een-gebruiker-gebaseerd-acl-systeem-afdwingen">Een gebruiker-gebaseerd ACL systeem afdwingen</h3>
<p>Stel dat je een mechanisme wil toevoegen dat gebruik maakt van een toegangscontrole lijst (ACL) die specificeert welke gebruikers zijn toegestaan om wijzigingen te pushen naar bepaalde delen van je project. Sommige mensen hebben volledige toegang, en anderen hebben alleen toestemming om wijzigingen te pushen naar bepaalde subdirectories of specifieke bestanden. Om dit af te dwingen zul je die regels schrijven in een bestand genaamd <code>acl</code> dat in je bare Git repository op de server zit. Je zult de <code>update</code> hook naar die regels laten kijken, zien welke bestanden worden geïntroduceerd voor elke commit die gepusht wordt en bepalen of de gebruiker die de push doet toestemming heeft om al die bestanden te wijzigen.</p>
<p>Het eerste dat je zult doen is de ACL schrijven. Hier zul je een formaat gebruiken wat erg lijkt op het CVS ACL mechanisme: het gebruikt een serie regels, waarbij het eerste veld <code>avail</code> of <code>unavail</code> is, het volgende veld een komma gescheiden lijst van de gebruikers is waarvoor de regel geldt en het laatste veld het pad is waarvoor deze regel geldt (leeg betekent open toegang). Alle velden worden gescheiden door een pipe (<code>|</code>) karakter.</p>
<p>In dit geval heb je een aantal beheerders, een aantal documentatie schrijvers met toegang tot de <code>doc</code> map, en één ontwikkelaar die alleen toegang heeft tot de <code>lib</code> en <code>test</code> mappen, en je ACL bestand ziet er zo uit:</p>
<pre><code>avail|nickh,pjhyett,defunkt,tpw
avail|usinclair,cdickens,ebronte|doc
avail|schacon|lib
avail|schacon|tests
</code></pre><p>Je begint met deze gegevens in een structuur in te lezen die je kunt gebruiken. In dit geval, om het voorbeeld eenvoudig te houden, zul je alleen de <code>avail</code> richtlijnen handhaven. Hier is een methode die je een associatieve array teruggeeft, waarbij de sleutel de gebruikersnaam is en de waarde een array van paden waar die gebruiker toegang tot heeft:</p>
<pre><code>def get_acl_access_data(acl_file)
  # lees ACL gegevens
  acl_file = File.read(acl_file).split(&quot;\n&quot;).reject { |line| line == &#39;&#39; }
  access = {}
  acl_file.each do |line|
    avail, users, path = line.split(&#39;|&#39;)
    next unless avail == &#39;avail&#39;
    users.split(&#39;,&#39;).each do |user|
      access[user] ||= []
      access[user] &lt;&lt; path
    end
  end
  access
end
</code></pre><p>Gegeven het ACL bestand dat je eerder bekeken hebt, zal deze <code>get_acl_access_data</code> methode een gegevensstructuur opleveren die er als volgt uit ziet:</p>
<pre><code>{&quot;defunkt&quot;=&gt;[nil],
 &quot;tpw&quot;=&gt;[nil],
 &quot;nickh&quot;=&gt;[nil],
 &quot;pjhyett&quot;=&gt;[nil],
 &quot;schacon&quot;=&gt;[&quot;lib&quot;, &quot;tests&quot;],
 &quot;cdickens&quot;=&gt;[&quot;doc&quot;],
 &quot;usinclair&quot;=&gt;[&quot;doc&quot;],
 &quot;ebronte&quot;=&gt;[&quot;doc&quot;]}
</code></pre><p>Nu je de rechten bepaald hebt, moet je bepalen welke paden de commits die gepusht worden hebben aangepast, zodat je kunt controleren dat de gebruiker die de push doet daar ook toegang tot heeft.</p>
<p>Je kunt eenvoudig zien welke bestanden gewijzigd zijn in een enkele commit met de <code>--name-only</code> optie op het <code>git log</code> commando (kort besproken in Hoofdstuk 2):</p>
<pre><code>$ git log -1 --name-only --pretty=format:&#39;&#39; 9f585d

README
lib/test.rb
</code></pre><p>Als je gebruik maakt van de ACL structuur die wordt teruggegeven door de <code>get_acl_access_data</code> methode en dat gebruikt met de bestanden in elk van de commits, dan kun je bepalen of de gebruiker toegang heeft om al hun commits te pushen:</p>
<pre><code># staat alleen bepaalde gebruikers toe om bepaalde subdirectories in een project te wijzigen
def check_directory_perms
  access = get_acl_access_data(&#39;acl&#39;)

  # kijk of iemand iets probeert te pushen waar ze niet bij mogen komen
  new_commits = `git rev-list #{$oldrev}..#{$newrev}`.split(&quot;\n&quot;)
  new_commits.each do |rev|
    files_modified = `git log -1 --name-only --pretty=format:&#39;&#39; #{rev}`.split(&quot;\n&quot;)
    files_modified.each do |path|
      next if path.size == 0
      has_file_access = false
      access[$user].each do |access_path|
        if !access_path || # gebruiker heeft overal toegang tot
          (path.index(access_path) == 0) # toegang tot dit pad
          has_file_access = true
        end
      end
      if !has_file_access
        puts &quot;[POLICY] You do not have access to push to #{path}&quot;
        exit 1
      end
    end
  end
end

check_directory_perms
</code></pre><p>Het meeste hiervan zou makkelijk te volgen moeten zijn. Je krijgt een lijst met commits die gepusht worden naar je server met <code>git rev-list</code>. Daarna vind je, voor iedere commit, de bestanden die aangepast worden en stelt vast of de gebruiker die pusht toegang heeft tot alle paden die worden aangepast. Een Ruby-isme dat wellicht niet duidelijk is, is <code>path.index(access_path) == 0</code>, wat waar is als het pad begint met <code>access_path</code> – dit zorgt ervoor dat <code>access_path</code> niet slechts in één van de toegestane paden zit, maar dat het voorkomt in alle toegestane paden.</p>
<p>Nu kunnen je gebruikers geen commits pushen met slecht vormgegeven berichten of met aangepaste bestanden buiten hun toegewezen paden.</p>
<h3 id="fast-forward-only-pushes-afdwingen">Fast-forward-only pushes afdwingen</h3>
<p>Het laatste om af te dwingen is fast-forward-only pushes. Om dit te regelen, kan je simpelweg de <code>receive.denyDeletes</code> en <code>receive.denyNonFastForwards</code> instellingen aanpassen. Maar dit afdwingen met behulp van een hook werkt ook, en je kunt het aanpassen zodat het alleen gebeurt bij bepaalde gebruikers of om elke reden die je later bedenkt.</p>
<p>De logica om dit te controleren, is te kijken of er een commit is die bereikbaar is vanuit de oudere revisie, maar niet bereikbaar is vanuit de nieuwere. Als er geen zijn dan was het een fast-forward push, anders weiger je het:</p>
<pre><code># dwingt fast-forward-only pushes af
def check_fast_forward
  missed_refs = `git rev-list #{$newrev}..#{$oldrev}`
  missed_ref_count = missed_refs.split(&quot;\n&quot;).size
  if missed_ref_count &gt; 0
    puts &quot;[POLICY] Cannot push a non fast-forward reference&quot;
    exit 1
  end
end

check_fast_forward
</code></pre><p>Alles is ingesteld. Als je <code>chmod u+x .git/hooks/update</code> uitvoert, wat het bestand is waarin je al deze code gestopt hebt, en dan probeert een non-fast-forwarded referentie te pushen krijg je zoiets als dit:</p>
<pre><code>$ git push -f origin master
Counting objects: 5, done.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 323 bytes, done.
Total 3 (delta 1), reused 0 (delta 0)
Unpacking objects: 100% (3/3), done.
Enforcing Policies...
(refs/heads/master) (8338c5) (c5b616)
[POLICY] Cannot push a non-fast-forward reference
error: hooks/update exited with error code 1
error: hook declined to update refs/heads/master
To git@gitserver:project.git
 ! [remote rejected] master -&gt; master (hook declined)
error: failed to push some refs to &#39;git@gitserver:project.git&#39;
</code></pre><p>Er zijn hier een aantal interessante dingen. Ten eerste, zie je dit als de hook start met uitvoeren.</p>
<pre><code>Enforcing Policies...
(refs/heads/master) (fb8c72) (c56860)
</code></pre><p>Merk op dat je dat afgedrukt hebt naar stdout aan het begin van je update script. Het is belangrijk om te zien dat alles dat je script naar stdout uitvoert, naar de client overgebracht wordt.</p>
<p>Het volgende dat je op zal vallen is de foutmelding.</p>
<pre><code>[POLICY] Cannot push a non fast-forward reference
error: hooks/update exited with error code 1
error: hook declined to update refs/heads/master
</code></pre><p>De eerste regel was door jou afgedrukt, de andere twee komen van Git die je vertelt dat het update script met niet nul geëindigd is en dat die degene is die je push weigerde. Tot slot heb je dit:</p>
<pre><code>To git@gitserver:project.git
 ! [remote rejected] master -&gt; master (hook declined)
error: failed to push some refs to &#39;git@gitserver:project.git&#39;
</code></pre><p>Je zult een remote afwijs bericht zien voor elke referentie die door de hook wordt geweigerd, en het vertelt je dat het specifiek was geweigerd wegens een hook fout.</p>
<p>Daarnaast zal je een foutmelding zien als in één van je commits de referentie markering ontbreekt.</p>
<pre><code>[POLICY] Your message is not formatted correctly
</code></pre><p>Of als iemand een bestand probeert aan te passen waar ze geen toegang tot hebben en een commit proberen te pushen waar het in zit, dan zullen ze iets vergelijkbaars zien. Bijvoorbeeld, als een documentatie schrijver een commit probeert te pushen dat iets wijzigt dat in de <code>lib</code> map zit, dan zien ze</p>
<pre><code>[POLICY] You do not have access to push to lib/test.rb
</code></pre><p>Dat is alles. Vanaf nu, zolang als het <code>update</code> script aanwezig en uitvoerbaar is, zal je repository nooit teruggedraaid worden en zal nooit een commit bericht bevatten waar het patroon niet in zit, en je gebruikers zullen in hun bewegingsruimte beperkt zijn.</p>
<h2 id="hooks-aan-de-client-kant">Hooks aan de client-kant</h2>
<p>Het nadeel van deze aanpak is het zeuren dat geheid zal beginnen zodra de commits van je gebruikers geweigerd worden. Het feit dat hun zorgzaam vervaardigde werk op het laatste moment pas geweigerd wordt kan enorm frustrerend en verwarrend zijn en daarnaast zullen ze hun geschiedenis moeten aanpassen om het te corrigeren, wat niet altijd geschikt is voor de wat zwakkeren van hart.</p>
<p>Het antwoord op dit dilemma is een aantal client-kant hooks te leveren, die gebruikers kunnen gebruiken om hen te waarschuwen dat ze iets doen dat de server waarschijnlijk gaat weigeren. Op die manier kunnen ze alle problemen corrigeren voordat ze gaan committen en voordat die problemen lastiger te herstellen zijn. Omdat haken niet overgebracht worden bij het klonen van een project, moet je deze scripts op een andere manier distribueren en je gebruikers ze in hun <code>.git/hooks</code> map laten zetten en ze uitvoerbaar maken. Je kunt deze hooks in je project of in een apart project distribueren, maar er is geen manier om ze automatisch in te laten stellen.</p>
<p>Om te beginnen zou je de commit boodschap moeten controleren vlak voordat iedere commit opgeslagen wordt, zodat je weet dat de server je wijzigingen niet gaat weigeren omdat de commit boodschap een verkeerd formaat heeft. Om dit te doen, kun je de <code>commit-msg</code> hook toevoegen. Als je dat de commit boodschap laat lezen uit het bestand dat als eerste argument opgegeven wordt, en dat vergelijkt met het patroon dan kun je Git dwingen om de commit af te breken als het niet juist is:</p>
<pre><code>#!/usr/bin/env ruby
message_file = ARGV[0]
message = File.read(message_file)

$regex = /\[ref: (\d+)\]/

if !$regex.match(message)
  puts &quot;[POLICY] Your message is not formatted correctly&quot;
  exit 1
end
</code></pre><p>Als dat script op z&#39;n plaats staat (in <code>.git/hooks/commit-msg</code>), uitvoerbaar is en je commit met een verkeerd geformateerd bericht, dan zie je dit:</p>
<pre><code>$ git commit -am &#39;test&#39;
[POLICY] Your message is not formatted correctly
</code></pre><p>In dat geval is er geen commit gedaan. Maar als je bericht het juiste patroon bevat, dan staat Git je toe te committen:</p>
<pre><code>$ git commit -am &#39;test [ref: 132]&#39;
[master e05c914] test [ref: 132]
 1 files changed, 1 insertions(+), 0 deletions(-)
</code></pre><p>Vervolgens wil je er zeker van zijn dat je geen bestanden buiten je ACL scope aanpast. Als de <code>.git</code> directory van je project een kopie van het ACL bestand bevat dat je eerder gebruikte, dan zal het volgende <code>pre-commit</code> script die beperkingen voor je controleren:</p>
<pre><code>#!/usr/bin/env ruby

$user    = ENV[&#39;USER&#39;]

# [ insert acl_access_data method from above ]

# staat alleen bepaalde gebruikers toe bepaalde mappen aan te passen
def check_directory_perms
  access = get_acl_access_data(&#39;.git/acl&#39;)

  files_modified = `git diff-index --cached --name-only HEAD`.split(&quot;\n&quot;)
  files_modified.each do |path|
    next if path.size == 0
    has_file_access = false
    access[$user].each do |access_path|
    if !access_path || (path.index(access_path) == 0)
      has_file_access = true
    end
    if !has_file_access
      puts &quot;[POLICY] You do not have access to push to #{path}&quot;
      exit 1
    end
  end
end

check_directory_perms
</code></pre><p>Dit is grofweg hetzelfde script als aan de server kant, maar met twee belangrijke verschillen. Als eerste staat het ACL bestand op een andere plek, omdat dit script vanuit je werkdirectory draait, en niet vanuit je Git directory. Je moet het pad naar het ACL bestand wijzigen van dit</p>
<pre><code>access = get_acl_access_data(&#39;acl&#39;)
</code></pre><p>naar dit:</p>
<pre><code>access = get_acl_access_data(&#39;.git/acl&#39;)
</code></pre><p>Het andere belangrijke verschil is de manier waarop je een lijst krijgt met bestanden die gewijzigd is. Omdat de server kant methode naar de log van commits kijkt en nu je commit nog niet opgeslagen is, moet je de bestandslijst in plaats daarvan uit het staging area halen. In plaats van</p>
<pre><code>files_modified = `git log -1 --name-only --pretty=format:&#39;&#39; #{ref}`
</code></pre><p>moet je dit gebruiken</p>
<pre><code>files_modified = `git diff-index --cached --name-only HEAD`
</code></pre><p>Maar dat zijn de enige twee verschillen - verder werkt het script op dezelfde manier. Een aandachtspunt is dat het van je verlangt dat je lokaal werkt als dezelfde gebruiker die pusht naar de remote machine. Als dat anders is, moet je de <code>$user</code> variabele handmatig instellen.</p>
<p>Het laatste wat je moet doen is het controleren dat je niet probeert non-fast-forward referenties te pushen, maar dat komt minder voor. Om een referentie te krijgen dat non-fast-forward is, moet je voorbij een commit rebasen die je al gepusht hebt, of een andere lokale branch naar dezelfde remote branch proberen te pushen.</p>
<p>Omdat de server je zal vertellen dat je geen non-fast-forward push kunt doen, en de hook de push tegenhoudt, is het enige ding wat je kunt proberen af te vangen het abusievelijk rebasen van commits die je al gepusht hebt.</p>
<p>Hier is een voorbeeld pre-rebase script dat daarop controleert. Het haalt een lijst met alle commits die je op het punt staat te herschrijven, en controleert of ze al ergens bestaan in één van je remote referenties. Als het er een ziet die bereikbaar is vanuit een van je remote referenties, dan stopt het de rebase:</p>
<pre><code>#!/usr/bin/env ruby

base_branch = ARGV[0]
if ARGV[1]
  topic_branch = ARGV[1]
else
  topic_branch = &quot;HEAD&quot;
end

target_shas = `git rev-list #{base_branch}..#{topic_branch}`.split(&quot;\n&quot;)
remote_refs = `git branch -r`.split(&quot;\n&quot;).map { |r| r.strip }

target_shas.each do |sha|
  remote_refs.each do |remote_ref|
    shas_pushed = `git rev-list ^#{sha}^@ refs/remotes/#{remote_ref}`
    if shas_pushed.split(“\n”).include?(sha)
      puts &quot;[POLICY] Commit #{sha} has already been pushed to #{remote_ref}&quot;
      exit 1
    end
  end
end
</code></pre><p>Dit script gebruikt een syntax dat niet behandeld is in de Revisie Selectie paragraaf van Hoofdstuk 6. Je krijgt een lijst van commits die al gepusht zijn door dit uit te voeren:</p>
<pre><code>git rev-list ^#{sha}^@ refs/remotes/#{remote_ref}
</code></pre><p>De <code>SHA^@</code> syntax wordt vervangen door alle ouders van die commit. Je bent op zoek naar een commit die bereikbaar is vanuit de laatste commit op de remote en die niet bereikbaar is vanuit enige ouder van alle SHA&#39;s die je probeert te pushen – wat betekent dat het een fast-forward is.</p>
<p>Het grote nadeel van deze aanpak is dat het erg traag kan zijn en vaak onnodig is, als je de push niet probeert te forceren met de <code>-f</code> optie, dan zal de server je al waarschuwen en de push niet accepteren. Maar, het is een aardige oefening en kan je in theorie helpen om een rebase te voorkomen die je later zult moeten herstellen.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../git_op_maat_maken/git_haken_hooks.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../git_op_maat_maken/samenvatting.html" class="navigation navigation-next"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../gitbook/app.js"></script>
        

    
    <script src="../gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
